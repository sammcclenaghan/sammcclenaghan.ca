---
---

<header class="my-12">
	<nav class="flex items-center gap-8">
		<a
			href="/"
			class="nav-button text-muted-foreground hover:text-blue-300 transition-colors duration-200 flex items-center gap-1 rounded-md px-1 py-1 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
			aria-keyshortcuts="h"
			data-section="home"
		>
			home
		</a>
		<a
			href="/blog"
			class="nav-button text-muted-foreground hover:text-blue-300 transition-colors duration-200 flex items-center gap-1 rounded-md px-1 py-1 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
			aria-keyshortcuts="b"
			data-section="blog"
		>
			blog
		</a>
		<a
			href="/projects"
			class="nav-button text-muted-foreground hover:text-blue-300 transition-colors duration-200 flex items-center gap-1 rounded-md px-1 py-1 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-blue-600"
			aria-keyshortcuts="p"
			data-section="projects"
		>
			projects
		</a>
	</nav>
</header>

<script>
	// Apply incremental fade-in to all .animate elements
	function applySequentialFade() {
		const elements = document.querySelectorAll<HTMLElement>('.animate');
		elements.forEach((el, i) => {
			el.style.setProperty('--i', String(i + 1));
			// Restart animation in case elements persist between transitions
			el.style.animation = 'none';
			void el.offsetWidth; // reflow
			el.style.animation = '';
		});
	}

	// Prepare stagger on the incoming document before swap
	function applySequentialFadeForDocument(doc: Document) {
		const elements = doc.querySelectorAll<HTMLElement>('.animate');
		elements.forEach((el, i) => {
			el.style.setProperty('--i', String(i + 1));
		});
	}

	// Initialize on page load and navigation
	document.addEventListener('DOMContentLoaded', () => {
		applySequentialFade();
	});
	document.addEventListener('astro:page-load', () => {
		applySequentialFade();
	});

	// Ensure stagger is ready before the new DOM is swapped in SPA navigations
	document.addEventListener('astro:before-swap', (event: any) => {
		applySequentialFadeForDocument(event.newDocument as Document);
	});

	// Keyboard navigation
	document.addEventListener('keydown', (e) => {
		if (e.defaultPrevented) return;
		if (e.metaKey || e.ctrlKey || e.altKey) return;

		// Check if we're in an editable element
		const activeElement = document.activeElement;
		const tagName = activeElement?.tagName?.toLowerCase();
		const isEditable = tagName === 'input' ||
						  tagName === 'textarea' ||
						  (activeElement && 'isContentEditable' in activeElement && activeElement.isContentEditable) ||
						  tagName === 'select';

		if (isEditable) return;

		const key = e.key?.toLowerCase();
		const keyToSection: Record<string, string> = { h: 'home', b: 'blog', p: 'projects' };
		const section = keyToSection[key];
		if (section) {
			e.preventDefault();
			const link = document.querySelector<HTMLAnchorElement>(`a[data-section="${section}"]`);
			link?.click();
		}
	});
</script>


