---
---

<header class="my-12">
	<nav class="flex items-center gap-8">
		<a
			href="/"
			class="nav-button text-sm transition-colors duration-200 flex items-center gap-1"
			data-section="home"
		>
			[h] home
		</a>
		<a
			href="/blog"
			class="nav-button text-sm transition-colors duration-200 flex items-center gap-1"
			data-section="blog"
		>
			[b] blog
		</a>
		<a
			href="/projects"
			class="nav-button text-sm transition-colors duration-200 flex items-center gap-1"
			data-section="projects"
		>
			[p] projects
		</a>
	</nav>
</header>

<script>
	// Update active button based on current path
	function updateActiveButton() {
		const currentPath = window.location.pathname;
		const pathToSection: Record<string, string> = {
			'/': 'home',
			'/blog': 'blog',
			'/projects': 'projects',
		};
		const currentSection = pathToSection[currentPath] || 'home';

		const buttons = document.querySelectorAll('.nav-button');
		buttons.forEach(button => {
			const section = button.getAttribute('data-section');
			if (section === currentSection) {
				button.classList.remove('text-muted-foreground', 'hover:text-foreground');
				button.classList.add('text-foreground');
			} else {
				button.classList.remove('text-foreground');
				button.classList.add('text-muted-foreground', 'hover:text-foreground');
			}
		});
	}

	// Apply incremental fade-in to all .animate elements
	function applySequentialFade() {
		const elements = document.querySelectorAll<HTMLElement>('.animate');
		elements.forEach((el, i) => {
			el.style.setProperty('--i', String(i + 1));
			// Restart animation in case elements persist between transitions
			el.style.animation = 'none';
			void el.offsetWidth; // reflow
			el.style.animation = '';
		});
	}

	// Prepare stagger on the incoming document before swap
	function applySequentialFadeForDocument(doc: Document) {
		const elements = doc.querySelectorAll<HTMLElement>('.animate');
		elements.forEach((el, i) => {
			el.style.setProperty('--i', String(i + 1));
		});
	}

	// Initialize on page load and navigation
	document.addEventListener('DOMContentLoaded', () => {
		updateActiveButton();
		applySequentialFade();
	});
	document.addEventListener('astro:page-load', () => {
		updateActiveButton();
		applySequentialFade();
	});

	// Ensure stagger is ready before the new DOM is swapped in SPA navigations
	document.addEventListener('astro:before-swap', (event: any) => {
		applySequentialFadeForDocument(event.newDocument as Document);
	});

	// Keyboard navigation
	document.addEventListener('keydown', (e) => {
		if (e.defaultPrevented) return;
		if (e.metaKey || e.ctrlKey || e.altKey) return;

		// Check if we're in an editable element
		const activeElement = document.activeElement;
		const tagName = activeElement?.tagName?.toLowerCase();
		const isEditable = tagName === 'input' ||
						  tagName === 'textarea' ||
						  (activeElement && 'isContentEditable' in activeElement && activeElement.isContentEditable) ||
						  tagName === 'select';

		if (isEditable) return;

		const key = e.key?.toLowerCase();
		const keyToSection: Record<string, string> = { h: 'home', b: 'blog', p: 'projects' };
		const section = keyToSection[key];
		if (section) {
			e.preventDefault();
			const link = document.querySelector<HTMLAnchorElement>(`a[data-section="${section}"]`);
			link?.click();
		}
	});
</script>


