---
---

<footer class="animate">
    <div class="flex justify-between items-center pt-8">
      <div class="text-sm text-muted-foreground">
        &copy; 2025 {`|`} Sam McClenaghan
      </div>
      <div class="flex flex-wrap gap-1 items-center">
        <button
          data-theme="light"
          aria-label="Light theme"
          class="group size-8 flex items-center justify-center rounded-full hover:bg-secondary transition-colors duration-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"
          >
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>
        </button>
        <button
          data-theme="dark"
          aria-label="Dark theme"
          class="group size-8 flex items-center justify-center rounded-full hover:bg-secondary transition-colors duration-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"
          >
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
          </svg>
        </button>
        <button
          data-theme="system"
          aria-label="System theme"
          aria-pressed="false"
          class="group size-8 flex items-center justify-center rounded-full hover:bg-secondary transition-colors duration-200"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="1.5"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="group-hover:stroke-black group-hover:dark:stroke-white transition-colors duration-300 ease-in-out"
          >
            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
            <line x1="8" y1="21" x2="16" y2="21"></line>
            <line x1="12" y1="17" x2="12" y2="21"></line>
          </svg>
        </button>
      </div>
  </div>

  <script>
    (() => {
      type ThemeMode = 'light' | 'dark' | 'system';
      const STORAGE_KEY = 'theme';
      const THEME_LIGHT = 'light';
      const THEME_DARK = 'dark';
      const THEME_SYSTEM = 'system';

      const docEl = document.documentElement;
      const media = window.matchMedia('(prefers-color-scheme: dark)');

      function getStoredTheme(): ThemeMode {
        const value = localStorage.getItem(STORAGE_KEY);
        return value === THEME_LIGHT || value === THEME_DARK || value === THEME_SYSTEM
          ? (value as ThemeMode)
          : THEME_SYSTEM;
      }

      function systemPrefersDark(): boolean {
        return media.matches;
      }

      function computeIsDark(mode: ThemeMode): boolean {
        return mode === THEME_DARK || (mode === THEME_SYSTEM && systemPrefersDark());
      }

      function applyTheme(mode: ThemeMode): void {
        const isDark = computeIsDark(mode);
        docEl.classList.toggle('dark', isDark);
        docEl.dataset.theme = mode;
      }

      function updateButtonsActive(mode: ThemeMode): void {
        const buttons = document.querySelectorAll('button[data-theme]');
        buttons.forEach((btn: Element) => {
          const isActive = (btn.getAttribute('data-theme') as ThemeMode | null) === mode;
          btn.setAttribute('aria-pressed', String(isActive));
        });
      }

      function setTheme(mode: ThemeMode): void {
        localStorage.setItem(STORAGE_KEY, mode);
        if (document.startViewTransition) {
          document.startViewTransition(() => applyTheme(mode));
        } else {
          applyTheme(mode);
        }
        updateButtonsActive(mode);
      }

      function wireButtons(): void {
        const buttons = document.querySelectorAll('button[data-theme]');
        buttons.forEach((btn: Element) => {
          (btn as HTMLElement).addEventListener('click', () => {
            const modeAttr = btn.getAttribute('data-theme') as ThemeMode | null;
            if (modeAttr) setTheme(modeAttr);
          });
        });
      }

      // Keep system mode in sync with OS changes
      media.addEventListener('change', () => {
        if (getStoredTheme() === THEME_SYSTEM) {
          applyTheme(THEME_SYSTEM);
        }
      });

      // Ensure correct theme is applied to the incoming document before swap to avoid flash
      document.addEventListener('astro:before-swap', (event) => {
        const mode = getStoredTheme();
        const newDoc = event.newDocument;
        const html = newDoc.documentElement;
        const isDark = computeIsDark(mode);
        html.classList.toggle('dark', isDark);
        html.dataset.theme = mode;
      });

      // Re-wire buttons on each page load under SPA navigation
      document.addEventListener('astro:page-load', () => {
        applyTheme(getStoredTheme());
        wireButtons();
        updateButtonsActive(getStoredTheme());
      });

      // Initial setup
      applyTheme(getStoredTheme());
      wireButtons();
      updateButtonsActive(getStoredTheme());
    })();
  </script>

</footer>
